---
description: "지식 자료 관리 시 참고하세요 - 업로드, 크롤링, 벡터 검색, RAG 시스템 기능"
---

## 5. 지식 자료 (Knowledge & Assets)

### 업로드 타입 및 처리 방식
* **PDF 업로드**: 파일 업로드 → 텍스트 추출 → 청킹 → 임베딩 → 지식 저장
* **YouTube 업로드**: URL 입력 → Apify로 자막 추출 → 청킹 → 임베딩 → 지식 저장  
* **웹사이트 URL**: URL 입력 → Firecrawl로 스크래핑 → 청킹 → 임베딩 → 지식 저장
* **텍스트 직접 입력**: 사용자 입력(최대 10,000자) → 청킹 → 임베딩 → 지식 저장

### 라우터
* `GET /api/assets/[assetId]`: 특정 자료(지식)의 상세 내용과 메타데이터를 조회합니다.
* `DELETE /api/assets/[assetId]`: 특정 자료(지식)와 연관된 청크를 함께 삭제합니다.
* `GET /api/canvases/[canvasId]/knowledge`: 특정 캔버스에 속한 모든 지식 자료 목록을 조회합니다.
* `POST /api/canvases/[canvasId]/crawl-and-save`: URL을 크롤링하거나 YouTube 자막을 추출하여 즉시 지식으로 저장합니다.
* `POST /api/workspaces/[workspaceId]/assets`: URL, YouTube, 텍스트 등 다양한 타입의 자료를 업로드하고 지식으로 저장합니다.
* `POST /api/workspaces/[workspaceId]/upload-pdf`: PDF 파일을 업로드하고 텍스트 추출, 청킹 후 지식으로 저장합니다.

### UI 컴포넌트
* `UploadModal`: 업로드 타입별 모달 라우터 (PDF, YouTube, URL, 텍스트)
* `TextUploadModal`: 텍스트 직접 입력 모달 (제목/본문, 10,000자 제한, 글자수 카운트)
* `PdfUploadModal`: PDF 파일 업로드 모달
* `YoutubeUploadModal`: YouTube URL 입력 모달
* `ScrapingUploadModal`: 웹사이트 URL 입력 모달
* `Sidebar`: 지식 업로드 버튼들과 업로드된 자료 목록 표시, 클릭 시 미리보기 모달

### 스키마 (Drizzle ORM)
* `canvasKnowledge`: 업로드된 자료의 원문(`content`), 처리된 내용(`processedContent`), 메타데이터(`title`, `assetType`, `metadata`, `sourceUrl`)를 저장합니다.
* `knowledgeChunks`: `canvasKnowledge`의 `content`를 청크로 나누고, 벡터 임베딩과 함께 저장하여 RAG 검색에 사용합니다.
* `assets`: 워크스페이스별 업로드 자료의 기본 정보(`type`, `title`, `status`, `metaJson`, `fileRef`)를 관리합니다.
* `assetChunks`: 자료를 청크로 분할하고 벡터 임베딩을 저장하여 시맨틱 검색을 지원합니다.

### 서비스 함수/훅
* `CanvasRAGService (Service)`: 사용자 질문에 대해 지식 자료를 벡터 검색하고 웹 검색을 결합하여 AI 답변 컨텍스트를 구성합니다.
* `upsertCanvasNodeKnowledge (Service)`: 노드 데이터를 `canvas_knowledge`로 동기화하여 AI가 참조할 수 있도록 합니다.
* `upsertCanvasMemoKnowledge (Service)`: 메모 데이터를 `canvas_knowledge`로 동기화합니다.
* `upsertCanvasTodoKnowledge (Service)`: 할일 데이터를 `canvas_knowledge`로 동기화합니다.
* `extractYouTubeTranscript (Service)`: Apify를 사용하여 YouTube 영상의 자막과 메타데이터를 추출합니다.
* `firecrawlService (Service)`: Firecrawl API를 사용하여 웹사이트 콘텐츠를 스크래핑하고 구조화합니다.
* `OpenAIService`: 텍스트 임베딩 생성과 청킹을 담당합니다.
* `assetProcessor (Service)`: 다양한 타입의 자료를 통합 처리하여 지식으로 변환합니다.

### 업로드 워크플로우
1. **사용자 액션**: 사이드바에서 업로드 타입 선택 (PDF/YouTube/URL/텍스트)
2. **모달 표시**: 해당 타입의 업로드 모달이 열림
3. **데이터 입력**: 파일 업로드 또는 URL/텍스트 입력
4. **서버 처리**: `/api/workspaces/[workspaceId]/assets` POST 요청
5. **지식 변환**: 
   - PDF: 텍스트 추출 → 청킹 → 임베딩
   - YouTube: 자막 추출 → 청킹 → 임베딩  
   - URL: 스크래핑 → 청킹 → 임베딩
   - 텍스트: 직접 청킹 → 임베딩
6. **저장 완료**: `canvas_knowledge`와 `knowledge_chunks` 테이블에 저장
7. **UI 업데이트**: 사이드바에 업로드된 자료 목록 표시
8. **미리보기**: 자료 클릭 시 `/api/assets/[assetId]` GET으로 본문 조회 후 모달 표시

### 핵심 특징
* **멀티소스 지원**: PDF, YouTube, 웹사이트, 텍스트 등 다양한 형태의 지식 자료를 통합 관리합니다.
* **벡터 검색**: OpenAI 임베딩을 활용한 시맨틱 검색으로 관련성 높은 지식을 빠르게 찾습니다.
* **자동 동기화**: 캔버스 내 노드, 메모, 할일 변경 시 자동으로 지식 베이스에 반영하여 AI가 최신 정보를 활용할 수 있습니다.
* **실시간 미리보기**: 업로드된 자료를 클릭하면 즉시 본문 내용을 모달로 확인할 수 있습니다.
* **통합 관리**: 모든 타입의 지식 자료를 하나의 인터페이스에서 관리하고 검색할 수 있습니다.