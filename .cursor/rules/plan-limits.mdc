---
description: "플랜별 제한 및 사용량 관리 시 참고하세요"
alwaysApply: false
---
## 1. 플랜별 제한 (Plan Limits & Usage Management)

### 무료 플랜 제한사항
* **워크스페이스**: 최대 1개 생성 가능
* **캔버스**: 최대 1개 생성 가능  
* **아이템 수**: 노드+메모+할일 합계 최대 10개
* **협업자**: 초대 불가 (멤버 관리 기능 제한)
* **AI 질문**: 하루 최대 5개 (매일 자정 리셋)
* **지식 자료**: 캔버스당 최대 3개 업로드

### Pro 플랜 혜택
* **워크스페이스**: 무제한 생성
* **캔버스**: 무제한 생성
* **아이템 수**: 무제한 노드+메모+할일
* **협업자**: 무제한 초대 및 멤버 관리
* **AI 질문**: 무제한 질문
* **지식 자료**: 무제한 업로드

### 핵심 서비스 함수
* **`lib/planLimits.ts`**: 플랜 제한 로직의 중앙 집중화
  * `isFreePlan(userId)`: 사용자 플랜 상태 확인
  * `getCanvasItemCounts(canvasId)`: 캔버스 아이템 수 계산 (메모+할일)
  * `getDailyAIChatCount(userId)`: 일일 AI 질문 수 조회
  * `incrementDailyAIChatCount(userId)`: AI 질문 수 증가
  * `getKnowledgeCount(canvasId)`: 캔버스 지식 자료 수 조회

### 서버사이드 제한 적용
* **`app/api/workspaces/route.ts`**: 워크스페이스 생성 시 1개 제한
* **`app/api/canvases/route.ts`**: 캔버스 생성 시 1개 제한
* **`app/api/canvases/[canvasId]/state/route.ts`**: 캔버스 상태 저장 시 10개 아이템 제한
* **`app/api/canvases/[canvasId]/memos/route.ts`**: 메모 생성 시 10개 아이템 제한
* **`app/api/canvases/[canvasId]/todos/route.ts`**: 할일 생성 시 10개 아이템 제한
* **`app/api/canvases/[canvasId]/shares/route.ts`**: 협업자 초대 시 무료 플랜 차단
* **`app/api/chat/canvas/route.ts`**: AI 질문 시 일일 5개 제한
* **`app/api/workspaces/[workspaceId]/assets/route.ts`**: 지식 자료 업로드 시 3개 제한
* **`app/api/canvases/[canvasId]/crawl-and-save/route.ts`**: 웹 스크래핑 시 3개 제한
* **`app/api/workspaces/[workspaceId]/upload-pdf/route.ts`**: PDF 업로드 시 3개 제한

### 클라이언트사이드 사용자 경험
* **사전 검사**: 서버 요청 전 클라이언트에서 제한 사전 확인
* **토스트 안내**: 제한 초과 시 사용자 친화적 메시지 표시
* **UI 반영**: `components/Canvas/CanvasHeader.tsx`에서 플랜별 혜택 표시
* **버튼 비활성화 금지**: 사용자 요청에 따라 버튼은 활성 상태 유지, 클릭 시 안내만 제공

### 에러 처리 표준
* **구조화된 에러**: `lib/queryClient.ts`에서 JSON 응답 파싱 및 구조화
* **사용자 친화적 메시지**: 서버 에러를 사용자가 이해하기 쉬운 메시지로 변환
* **일관된 토스트**: 모든 제한 관련 에러는 동일한 패턴으로 토스트 표시
* **업그레이드 안내**: 제한 도달 시 Pro 플랜 업그레이드 유도 메시지 포함

### 데이터베이스 스키마
* **`profiles`**: 사용자 플랜 정보 저장 (`plan_type: 'free'|'pro'`)
* **`daily_ai_chat_counts`**: 일일 AI 질문 수 추적 (매일 자정 리셋)
* **실시간 동기화**: Supabase 실시간 구독으로 사용량 변경 즉시 반영